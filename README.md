# BTC历史数据下载和处理工具

这是一套完整的BTC历史数据下载和处理工具，可以从Binance Vision下载数据并转换为美股交易时间段的数据。

## 📁 文件结构

```
okx_demo/
├── download_monthly_btc.py                    # 月度数据下载脚本
├── convert_to_et_trading_hours.py             # 时区转换和交易时间过滤脚本
├── requirements.txt                           # Python依赖包
├── btc_monthly_data/                          # 下载的原始数据目录
│   └── btc_1m_202401_202505_monthly_merged.csv
└── btc_1m_202401_202505_monthly_merged_et_trading_hours.csv  # 最终处理结果
```

## 🚀 使用流程

### 第一步：安装依赖

```bash
pip install -r requirements.txt
```

### 第二步：下载BTC历史数据

运行月度下载脚本：

```bash
python download_monthly_btc.py
```

这将下载2024年1月到2025年5月的所有月度数据，并自动合并为一个文件。

**输出：** `btc_monthly_data/btc_1m_202401_202505_monthly_merged.csv`
- 📊 **数据量：** 744,480条记录
- 📅 **时间范围：** 2024-01-01 00:00:00 到 2025-05-31 23:59:00 (UTC时间)
- 💾 **文件大小：** 45.3 MB

### 第三步：转换时区和过滤交易时间

运行时区转换脚本：

```bash
python convert_to_et_trading_hours.py
```

这将：
1. 将UTC时间转换为美东时区（自动处理夏令时）
2. 只保留美股交易时间：9:40 AM - 4:00 PM
3. 只保留工作日数据（周一到周五）

**输出：** `btc_1m_202401_202505_monthly_merged_et_trading_hours.csv`
- 📊 **数据量：** 140,970条记录
- 📅 **时间范围：** 2024-01-01 09:40:00 到 2025-05-30 16:00:00 (美东时间)
- 💾 **文件大小：** 8.6 MB
- 📈 **过滤比例：** 18.9% (从原始数据中保留)

## 📊 数据格式

最终生成的文件格式：

```csv
DateTime,Open,High,Low,Close,Volume
2024-01-01 09:40:00,42618.23,42631.83,42596.91,42631.82,26.1357
2024-01-01 09:41:00,42631.83,42644.35,42631.82,42644.34,7.493
...
```

### 列说明

- **DateTime**: 美东时区时间，格式为 YYYY-MM-DD HH:MM:SS
- **Open**: 开盘价
- **High**: 最高价
- **Low**: 最低价
- **Close**: 收盘价
- **Volume**: 成交量

## 🛠️ 高级用法

### 自定义输入文件

```bash
# 指定自定义输入文件
python convert_to_et_trading_hours.py your_btc_data.csv

# 指定输出文件名
python convert_to_et_trading_hours.py input.csv -o output.csv
```

### 数据分析

在转换之前分析数据分布：

```bash
python convert_to_et_trading_hours.py input.csv -a
```

这将显示：
- 按小时的数据分布
- 按工作日的数据分布
- 交易时间占比统计

## 📈 数据质量验证

### 时间连续性检查

```bash
# 检查是否有非交易时间的数据
grep -E "(0[0-8]|1[7-9]|2[0-3]):" btc_1m_202401_202505_monthly_merged_et_trading_hours.csv
```

应该没有输出，表示所有数据都在交易时间内。

### 工作日检查

```bash
# 检查是否有周末数据（需要安装date命令）
# 这里可以通过Python脚本进一步验证
```

## 🔧 脚本功能详解

### download_monthly_btc.py

**功能：**
- 从Binance Vision下载月度K线数据
- 支持2024年1月到2025年5月的数据
- 自动处理时间戳格式变化（2025年开始使用微秒）
- 进度显示和错误处理
- 自动合并和去重

**特点：**
- 智能下载：优先下载月度文件（效率更高）
- 容错处理：网络错误自动重试
- 数据验证：自动检查数据完整性

### convert_to_et_trading_hours.py

**功能：**
- UTC到美东时区转换
- 自动处理夏令时变化
- 美股交易时间过滤（9:40-16:00）
- 工作日过滤（周一到周五）
- 数据分析和统计

**特点：**
- 精确时区处理：使用pytz库确保时区转换准确
- 灵活配置：可以轻松修改交易时间范围
- 详细统计：提供转换前后的数据统计

## 🎯 使用场景

这套工具特别适合：

1. **量化交易研究**：获取美股交易时间段的BTC数据
2. **市场分析**：分析BTC在美股交易时间的表现
3. **策略回测**：使用标准化的交易时间数据
4. **数据科学**：为机器学习模型准备特征数据

## ⚠️ 注意事项

1. **时区处理**：脚本假设原始数据为UTC时间
2. **交易时间**：目前设置为9:40-16:00，可根据需要调整
3. **数据延迟**：Binance数据通常在第二天可用
4. **存储空间**：完整数据需要约50MB存储空间

## 🔄 后续更新

如需下载更新的数据：

1. 修改`download_monthly_btc.py`中的月份范围
2. 重新运行下载脚本
3. 运行时区转换脚本处理新数据

## 📞 技术支持

如遇到问题：

1. 检查网络连接
2. 确认依赖包已正确安装
3. 查看脚本输出的错误信息
4. 检查输入文件格式是否正确 